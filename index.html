<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Review Card Generator</title>
		<!-- Bootstrap CSS -->
		<link
			href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
			rel="stylesheet"
		/>
		<link
			href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;700&display=swap"
			rel="stylesheet"
		/>

		<link rel="preconnect" href="https://fonts.googleapis.com" />
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
		<link
			href="https://fonts.googleapis.com/css2?family=Rubik:wght@500&display=swap"
			rel="stylesheet"
		/>
		<link rel="preconnect" href="https://fonts.googleapis.com" />
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
		<link
			href="https://fonts.googleapis.com/css2?family=Rubik&display=swap"
			rel="stylesheet"
		/>
		<link
			href="https://fonts.googleapis.com/css2?family=Josefin+Sans:wght@600&display=swap"
			rel="stylesheet"
		/>
		<link rel="stylesheet" href="styles.css" />
	</head>

	<body>

		<ul class="nav navbar">
			<li class="nav-item nav-div container">
				<img
					src="contracting-empire-logo.png"
					alt="contracting empire logo"
					id="logo"
				/>
			</li>
		</ul>

		<div class="container my-5">
			<div
				class="card mb-3"
				style="max-width: 1230px; background-color: #eae8e8; border: none"
			>
				<div class="row g-0">
					<div class="col-md-6">
						<div class="card-body ps-0">
							<h1 class="title mb-3">Review Card Generator</h1>
							<hr />
							<p class="card-text m-0 p-0">
								We just dropped the ultimate review card generator for
								contractors - 5 killer designs, instant QR code magic, and it's
								ALL YOURS. No catch, no cost - just a downloadable PDF you can
								take to the print shop. <br />
								<br />Watch this quick video to see how easy it is to get more
								5-star reviews (and look insanely professional doing it).
							</p>
						</div>
					</div>
					<div class="col-md-6 d-flex justify-content-end card-body pe-0">
						<iframe
							width="600"
							height="315"
							src="https://www.youtube.com/embed/tgbNymZ7vqY"
							class="video"
						>
						</iframe>
					</div>
				</div>
			</div>
			<div class="row">
				<!-- Form Section -->
				<div class="col-md-8">
					<form id="qr-form">
						<div class="mb-4">
							<span class="steps mb-2 mt-2 ms-2">1</span>
							<label for="url" class="form-label"
								>Enter Your Google Review URL:</label
							>
							<input
								type="text"
								id="url"
								name="url"
								value="https://google.com"
								class="form-control mt-2"
								required
							/>
						</div>

						<div class="mb-3">
							<span class="steps mt-2 ms-2">2</span>
							<label class="form-label">Select Design:</label>
							<div class="design-options-container ">
								<!-- Design Option 1 -->
								<div class="design-option ">
									<input
										type="radio"
										id="design1"
										name="design"
										value="Review cards-01.png"
										checked
									/>
									<label for="design1">
										<img src="Review cards-01.png" alt="Design 1" />
										<small class="d-block text-center mt-2 fs-6"
											>Gray With Website</small
										>
									</label>
								</div>
								<!-- Design Option 2 -->
								<div class="design-option">
									<input
										type="radio"
										id="design2"
										name="design"
										value="Review cards-02.png"
									/>
									<label for="design2">
										<img src="Review cards-02.png" alt="Design 2" />
										<small class="d-block text-center mt-2 fs-6"
											>Blue With Website</small
										>
									</label>
								</div>
								<!-- Design Option 3 -->
								<div class="design-option">
									<input
										type="radio"
										id="design3"
										name="design"
										value="Review cards-03.png"
									/>
									<label for="design3">
										<img src="Review cards-03.png" alt="Design 3" />
										<small class="d-block text-center mt-2 fs-6"
											>White With Logo</small
										>
									</label>
								</div>
								<!-- Design Option 4 -->
								<div class="design-option">
									<input
										type="radio"
										id="design4"
										name="design"
										value="Review cards-04.png"
									/>
									<label for="design4">
										<img src="Review cards-04.png" alt="Design 4" />
										<small class="d-block text-center mt-2 fs-6"
											>Gray with Logo</small
										>
									</label>
								</div>
								<!-- Design Option 5 -->
								<div class="design-option">
									<input
										type="radio"
										id="design5"
										name="design"
										value="Review cards-05.png"
									/>
									<label for="design5">
										<img src="Review cards-05.png" alt="Design 5" />
										<small class="d-block text-center mt-2 fs-6"
											>Ivory With Logo</small
										>
									</label>
								</div>
							</div>
						</div>

						<!-- Logo Upload Field -->
						<div id="logo-upload-section" class="mb-3" style="display: none">
							<span class="steps mb-2 ms-2">3</span>
							<label for="logo-upload" class="form-label"
								>Upload Your Logo (PNG, JPG):</label
							>
							<input
								type="file"
								id="logo-upload"
								accept="image/png, image/jpeg"
								class="form-control mt-2"
							/>
						</div>

						<!-- Website URL Input Field -->
						<div class="mb-3" id="website-input-section">
							<span class="steps mb-2 ms-2">3</span>
							<label for="website-text" class="form-label"
								>Enter Your Custom Text </label
							>
							<input
								type="text"
								id="website-text"
								class="form-control mt-2"
								placeholder="website url/business name/other"
							/>
						</div>
					</form>
				</div>

				<!-- Preview Section -->
				<div class="col-md-4 text-center">
					<div id="card-preview" class="mx-auto">
						<img
							id="card-background"
							src="new-guide-07.png"
							alt="Card Design Preview"
						/>
						<img id="logo-preview" src="" alt="Logo" />
						<div id="qrcode" title="https://google.com">
							<canvas width="118" height="118" style="display: none"></canvas>
							<img
								src="data:image/png;base64,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"
								style="display: block"
							/>
						</div>
						<!-- Guide Overlay -->
						<img
							id="guide-overlay"
							src="new-guide-07.png"
							alt="Guide Overlay"
						/>
						<div id="website-preview"></div>
					</div>
					<!-- Download button -->
					<div class="d-flex justify-content-center align-items-center">
						<span class="steps mt-3">4</span>
						<button
							id="download-btn"
							class="btn mt-3 btn-success bttn"
							style="display: inline-block"
						>
							Download as PDF
							<svg
								xmlns="http://www.w3.org/2000/svg"
								width="18"
								height="18"
								fill="currentColor"
								class="bi bi-download pb-1"
								viewBox="0 0 16 16"
							>
								<path
									d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5"
								/>
								<path
									d="M7.646 11.854a.5.5 0 0 0 .708 0l3-3a.5.5 0 0 0-.708-.708L8.5 10.293V1.5a.5.5 0 0 0-1 0v8.793L5.354 8.146a.5.5 0 1 0-.708.708z"
								/>
							</svg>
						</button>
					</div>
				</div>
			</div>
		</div>

		<!-- QR Code JS -->
		<script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>
		<!-- pdf-lib -->
		<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
		<!-- Bootstrap JS -->
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

		<script>
			const qrcodeDiv = document.getElementById("qrcode");
			const cardBackground = document.getElementById("card-background");
			const downloadBtn = document.getElementById("download-btn");
			const logoUploadSection = document.getElementById("logo-upload-section");
			const logoUploadInput = document.getElementById("logo-upload");
			const logoPreview = document.getElementById("logo-preview");
			const urlInput = document.getElementById("url");
			const websiteInputSection = document.getElementById(
				"website-input-section"
			);
			const websiteTextInput = document.getElementById("website-text");
			const websitePreview = document.getElementById("website-preview");

			let highResQRCodeDataURL = "";
			let logoDataURL = "";
			let qrCode;
			let designSupportsLogo = false;

			const designRadios = document.getElementsByName("design");

			// On page load
			window.addEventListener("load", function () {
				// Select "Design 1" by default
				const defaultDesign = document.getElementById("design1");
				defaultDesign.checked = true;

				// Update the card background and show the website input section
				cardBackground.src = defaultDesign.value;
				cardBackground.style.opacity = "1"; // Make the image visible

				websiteInputSection.style.display = "block";
				websitePreview.style.display = "block";

				// Generate QR code for default URL
				const defaultURL = urlInput.value.trim();
				if (defaultURL) {
					generateQRCode(defaultURL);
					generateHighResQRCode(defaultURL);
					downloadBtn.style.display = "inline-block";
				}
			});

			// When a design is selected, make the background visible
			Array.from(designRadios).forEach((radio) => {
				radio.addEventListener("change", function () {
					designSupportsLogo =
						radio.id === "design3" ||
						radio.id === "design4" ||
						radio.id === "design5";

					if (designSupportsLogo) {
						logoUploadSection.style.display = "block";
						if (logoDataURL) {
							logoPreview.style.display = "block";
						}
						websiteInputSection.style.display = "none";
						websitePreview.style.display = "none";
					} else {
						logoUploadSection.style.display = "none";
						logoPreview.style.display = "none";
						if (radio.id === "design1" || radio.id === "design2") {
							websiteInputSection.style.display = "block";
							websitePreview.style.display = "block";
						} else {
							websiteInputSection.style.display = "none";
							websitePreview.style.display = "none";
						}
					}

					// Update the image source and make it visible
					cardBackground.src = radio.value;
					cardBackground.style.opacity = "1"; // Make the image visible
				});
			});

			logoUploadInput.addEventListener("change", function (e) {
				const file = e.target.files[0];
				if (file && (file.type === "image/png" || file.type === "image/jpeg")) {
					const reader = new FileReader();
					reader.onload = function (event) {
						logoDataURL = event.target.result;
						if (designSupportsLogo) {
							logoPreview.src = logoDataURL;
							logoPreview.style.display = "block";
						}
					};
					reader.readAsDataURL(file);
				} else {
					alert("Please upload a valid PNG or JPEG image.");
					logoUploadInput.value = "";
				}
			});

			websiteTextInput.addEventListener("input", function () {
				websitePreview.textContent = websiteTextInput.value.trim();
			});

			function generateQRCode(url) {
				qrcodeDiv.innerHTML = "";
				const qrSize = 118;
				qrCode = new QRCode(qrcodeDiv, {
					text: url,
					width: qrSize,
					height: qrSize,
					correctLevel: QRCode.CorrectLevel.H,
				});
			}

			urlInput.addEventListener("input", function () {
				const url = urlInput.value.trim();
				if (url) {
					generateQRCode(url);
					generateHighResQRCode(url);
					downloadBtn.style.display = "inline-block";
				} else {
					qrcodeDiv.innerHTML = "";
					downloadBtn.style.display = "none";
					highResQRCodeDataURL = "";
				}
			});

			async function generateHighResQRCode(url) {
				if (!url) {
					highResQRCodeDataURL = "";
					return;
				}

				return new Promise((resolve, reject) => {
					const hiddenDiv = document.createElement("div");
					hiddenDiv.style.display = "none";
					document.body.appendChild(hiddenDiv);

					const dpi = 300;
					const inchToPx = dpi;
					const canvasWidth = 2.12 * inchToPx;
					const qrSize = (118 / 250) * canvasWidth;

					new QRCode(hiddenDiv, {
						text: url,
						width: qrSize,
						height: qrSize,
						correctLevel: QRCode.CorrectLevel.H,
					});

					setTimeout(() => {
						try {
							const qrCanvas = hiddenDiv.querySelector("canvas");
							if (qrCanvas) {
								highResQRCodeDataURL = qrCanvas.toDataURL("image/png");
								document.body.removeChild(hiddenDiv);
								resolve();
							} else {
								throw new Error("QR code canvas not found.");
							}
						} catch (error) {
							console.error("Error generating high-res QR code:", error);
							reject(error);
						}
					}, 500);
				});
			}

			downloadBtn.addEventListener("click", async function () {
				const url = urlInput.value.trim();
				const websiteText = websiteTextInput.value.trim();

				if (!highResQRCodeDataURL || !url) {
					alert("Please enter a valid URL to generate the QR code.");
					return;
				}

				const dpi = 300;
				const inchToPx = dpi;
				const canvasWidth = 2.12 * inchToPx;
				const canvasHeight = 3.62 * inchToPx;

				const canvas = document.createElement("canvas");
				canvas.width = canvasWidth;
				canvas.height = canvasHeight;
				const ctx = canvas.getContext("2d");

				const backgroundImg = new Image();
				backgroundImg.crossOrigin = "Anonymous";
				backgroundImg.src = cardBackground.src;
				backgroundImg.onload = function () {
					ctx.drawImage(backgroundImg, 0, 0, canvas.width, canvas.height);

					if (designSupportsLogo && logoDataURL) {
						const logoImg = new Image();
						logoImg.src = logoDataURL;
						logoImg.onload = function () {
							const logoMaxWidth = canvasWidth * 0.7;
							const logoMaxHeight = canvasHeight * 0.15;
							let logoWidth = logoImg.width;
							let logoHeight = logoImg.height;

							const widthRatio = logoMaxWidth / logoWidth;
							const heightRatio = logoMaxHeight / logoHeight;
							const minRatio = Math.min(widthRatio, heightRatio);

							logoWidth *= minRatio;
							logoHeight *= minRatio;

							const logoX = (canvasWidth - logoWidth) / 2;
							const logoY = canvasHeight * 0.07;
							ctx.drawImage(logoImg, logoX, logoY, logoWidth, logoHeight);

							drawQRCode(ctx, canvasWidth, canvasHeight, websiteText);
						};
					} else {
						drawQRCode(ctx, canvasWidth, canvasHeight, websiteText);
					}
				};

				function drawQRCode(ctx, canvasWidth, canvasHeight, websiteText) {
					const qrImg = new Image();
					qrImg.crossOrigin = "Anonymous";
					qrImg.src = highResQRCodeDataURL;
					qrImg.onload = async function () {
						const qrSize = (118 / 250) * canvasWidth;
						const qrX = (canvasWidth - qrSize) / 2;
						const qrY = (canvasHeight - qrSize) / 2;
						ctx.drawImage(qrImg, qrX, qrY, qrSize, qrSize);

						if (websiteText) {
							ctx.font = "400 25px Manrope";
							ctx.textAlign = "center";
							ctx.fillStyle = "#ffffff";
							ctx.fillText(websiteText, canvasWidth / 2, canvasHeight * 0.94);
						}

						const imgData = canvas.toDataURL("image/png", 1.0);
						const pdfDoc = await PDFLib.PDFDocument.create();

						const pageWidth = 2.12 * 72;
						const pageHeight = 3.62 * 72;

						const page = pdfDoc.addPage([pageWidth, pageHeight]);

						const pngImage = await pdfDoc.embedPng(imgData);

						page.drawImage(pngImage, {
							x: 0,
							y: 0,
							width: pageWidth,
							height: pageHeight,
						});

						const pdfBytes = await pdfDoc.save();

						const blob = new Blob([pdfBytes], { type: "application/pdf" });
						const url = URL.createObjectURL(blob);
						const a = document.createElement("a");
						a.href = url;
						a.download = "business_card.pdf";
						document.body.appendChild(a);
						a.click();
						document.body.removeChild(a);
						URL.revokeObjectURL(url);
					};
				}
			});
		</script>
	</body>
</html>
